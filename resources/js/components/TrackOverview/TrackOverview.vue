<template>
    <div class="flex track-overview">
        <svg xmlns="http://www.w3.org/2000/svg" width="1500" height="1500" viewBox="0 0 1500 1500" :key="key">
            <g transform="translate(0,1500) scale(0.1,-0.1)" fill="#000000" stroke="none">
                <path d="M3471 14199 c-598 -67 -1067 -387 -1335 -909 -185 -362 -263 -711 -236 -1064 25 -324 85 -535 367 -1281 191 -504 287 -767 374 -1025 146 -430 273 -651 524 -909 116 -120 238 -219 715 -581 410 -311 479 -368 611 -499 278 -278 465 -585 564 -926 46 -158 132 -617 165 -877 110 -867 377 -1557 859 -2220 138 -190 277 -351 552 -639 424 -444 590 -637 641 -745 76 -163 21 -321 -154 -434 -114 -75 -233 -87 -344 -36 -84 39 -111 64 -371 344 -411 441 -571 569 -818 651 -242 80 -459 65 -740 -51 -434 -179 -722 -269 -1068 -333 -289 -53 -340 -56 -1077 -65 -686 -9 -1308 -31 -1405 -50 -115 -23 -251 -79 -345 -143 -66 -45 -176 -154 -225 -222 -214 -301 -218 -687 -11 -1000 99 -147 230 -247 404 -305 189 -63 -239 -59 5764 -60 3863 -1 5507 2 5563 9 442 60 818 214 1135 468 367 292 638 705 774 1178 63 221 80 350 80 605 0 434 -68 729 -301 1315 -103 258 -283 662 -339 760 -210 364 -523 584 -876 614 -236 20 -488 -37 -718 -162 -91 -50 -603 -373 -1745 -1104 -1275 -815 -1353 -864 -1435 -900 -272 -118 -475 -62 -586 162 -33 66 -36 80 -32 137 6 91 36 142 165 280 135 144 197 233 234 342 62 176 24 343 -114 504 -69 80 -116 121 -347 301 -754 588 -1319 1205 -2077 2271 -804 1129 -1268 1934 -1612 2795 -229 573 -295 825 -295 1145 0 147 2 172 22 229 47 130 132 227 259 293 232 122 463 88 660 -95 81 -76 225 -248 359 -427 172 -231 410 -555 547 -744 187 -260 382 -515 484 -633 140 -162 256 -245 423 -299 77 -25 99 -28 225 -27 110 0 156 4 216 21 253 69 420 243 519 540 57 173 115 488 145 792 35 348 29 910 -12 1195 -65 460 -282 875 -571 1095 -92 70 -267 154 -383 184 -53 14 -171 32 -265 41 -747 71 -1184 140 -2412 381 -238 46 -479 91 -535 100 -125 18 -452 26 -566 13z m534 -438 c72 -11 277 -49 455 -85 401 -81 1436 -240 2280 -351 321 -42 383 -54 487 -95 141 -54 260 -154 321 -268 45 -83 146 -360 186 -504 92 -338 96 -524 26 -1373 -19 -221 -39 -404 -50 -455 -25 -107 -87 -235 -143 -292 -64 -66 -106 -83 -207 -83 -80 0 -90 3 -159 40 -215 114 -586 573 -1006 1245 -233 372 -362 534 -540 680 -425 347 -798 413 -1200 213 -207 -103 -360 -256 -442 -442 -54 -122 -75 -232 -80 -431 -6 -216 14 -390 72 -613 146 -569 560 -1479 1031 -2268 324 -543 694 -1086 1217 -1784 696 -928 1239 -1481 1937 -1970 147 -102 185 -136 212 -189 37 -73 3 -142 -135 -268 -98 -89 -165 -174 -214 -272 -210 -418 48 -941 532 -1077 109 -31 276 -31 389 0 106 28 266 98 381 166 100 59 543 341 2005 1280 487 312 936 598 998 636 111 67 229 119 313 138 67 16 208 13 270 -5 127 -37 303 -159 400 -277 108 -132 425 -837 573 -1277 129 -381 149 -690 70 -1048 -108 -487 -393 -912 -789 -1177 -280 -188 -564 -276 -943 -295 -243 -11 -9920 -23 -10457 -12 l-410 8 -79 28 c-43 15 -97 38 -120 51 -59 35 -130 111 -163 175 -26 51 -28 64 -28 171 0 113 1 116 38 191 63 128 175 212 324 243 78 16 325 23 1228 35 724 10 821 15 1155 71 413 68 822 185 1176 335 192 81 241 96 345 101 164 9 267 -34 438 -185 165 -146 423 -404 548 -549 215 -249 379 -336 633 -337 238 0 453 93 630 274 256 260 291 623 91 958 -71 120 -323 407 -681 777 -289 298 -446 490 -622 761 -362 556 -580 1168 -663 1859 -33 279 -119 727 -180 940 -114 402 -335 770 -636 1060 -106 102 -216 191 -775 623 -457 353 -525 410 -620 523 -166 196 -272 393 -378 704 -80 235 -188 533 -344 951 -330 879 -372 1031 -372 1349 0 224 30 378 117 590 196 483 560 764 1073 829 75 9 361 -4 485 -23z"/>
            </g>
                <g v-for="car in sortedCars">
                    <circle
                        :cx="!isPlaying ? 807.516 : '0'"
                        :cy="!isPlaying ? 1396.988 : '0'"
                        r="50"
                        :fill="car.color"
                        stroke="black"
                        :stroke-width="activeCar === car ? 10 : 0"
                    />
                    <text
                        :x="!isPlaying ? 807.516 : '0'"
                        :y="!isPlaying ? 1396.988 : '0'"
                        text-anchor="middle"
                        dy="18" fill="white"
                        font-size="60"
                    >
                        {{ car.number }}
                    </text>
                    <animateMotion
                        v-if="isPlaying"
                        repeatCount="indefinite"
                        :dur="timeToSeconds(car.averageLapTime) +'s'"
                        fill="freeze"
                        path="M 807.516 1396.988 L 696.685 1397.337 C 585.855 1397.685 364.193 1398.383 249.617 1397.478 C 135.04 1396.574 127.548 1394.068 120.612 1391.401 C 113.675 1388.734 107.295 1385.905 100.747 1378.286 C 94.199 1370.666 87.483 1358.255 84.366 1349.515 C 81.249 1340.775 81.73 1335.707 82.184 1329.921 C 82.637 1324.136 83.063 1317.634 85.804 1310.365 C 88.545 1303.096 93.602 1295.059 99.673 1288.487 C 105.743 1281.914 112.829 1276.805 122.703 1273.193 C 132.577 1269.581 145.239 1267.465 166.916 1265.863 C 188.594 1264.26 219.285 1263.17 245.713 1262.719 C 272.141 1262.268 294.306 1262.457 311.909 1262.136 C 329.513 1261.816 342.556 1260.986 353.116 1259.959 C 363.676 1258.931 371.752 1257.705 384.694 1254.848 C 397.636 1251.992 415.443 1247.504 435.114 1240.901 C 454.786 1234.298 476.321 1225.578 491.58 1220.371 C 506.839 1215.163 515.82 1213.467 523.744 1212.896 C 531.667 1212.326 538.532 1212.88 546.6 1215.591 C 554.668 1218.303 563.939 1223.17 574.393 1230.2 C 584.848 1237.23 596.485 1246.421 606.201 1255.772 C 615.916 1265.123 623.709 1274.634 631.741 1282.954 C 639.772 1291.275 648.043 1298.405 653.929 1303.205 C 659.816 1308.005 663.319 1310.475 668.954 1312.792 C 674.589 1315.108 682.355 1317.273 690.771 1317.904 C 699.187 1318.535 708.251 1317.634 716.903 1313.63 C 725.555 1309.626 733.794 1302.519 739.43 1294.656 C 745.066 1286.792 748.098 1278.172 749.267 1268.809 C 750.435 1259.447 749.74 1249.343 742.973 1235.28 C 736.207 1221.217 723.369 1203.196 707.588 1185.573 C 691.806 1167.95 673.079 1150.725 656.649 1132.85 C 640.218 1114.974 626.083 1096.446 614.075 1077.734 C 602.066 1059.022 592.184 1040.124 583.659 1021.022 C 575.134 1001.919 567.967 982.612 562.21 963.165 C 556.454 943.718 552.109 924.133 548.97 905.488 C 545.83 886.844 543.897 869.14 540.864 850.659 C 537.831 832.177 533.7 812.917 527.257 794.183 C 520.815 775.449 512.062 757.24 504.249 743.649 C 496.435 730.057 489.562 721.082 479.719 710.336 C 469.876 699.59 457.063 687.074 445.304 676.052 C 433.545 665.029 422.838 655.502 405.536 642.704 C 388.233 629.907 364.335 613.839 349.285 602.176 C 334.235 590.513 328.033 583.253 319.918 570.832 C 311.802 558.411 301.773 540.827 283.744 494.346 C 265.715 447.865 239.686 372.485 226.334 327.456 C 212.982 282.427 212.306 267.747 213.115 254.097 C 213.925 240.446 216.219 227.823 221.381 212.488 C 226.543 197.153 234.572 179.104 246.453 162.405 C 258.334 145.706 274.066 130.355 289.538 120.297 C 305.01 110.238 320.221 105.47 339.364 103.046 C 358.507 100.622 381.581 100.541 407.085 103.285 C 432.588 106.029 460.52 111.597 514.874 120.932 C 569.228 130.267 650.003 143.369 694.89 152.902 C 739.777 162.435 748.774 168.4 756.669 176.334 C 764.563 184.268 771.354 194.171 776.878 206.778 C 782.402 219.386 786.658 234.697 790.373 252.59 C 794.087 270.482 797.259 290.956 798.582 309.418 C 799.904 327.88 799.378 344.331 796.92 368.795 C 794.462 393.26 790.074 425.737 785.415 446.326 C 780.755 466.915 775.826 475.615 768.972 481.628 C 762.118 487.64 753.341 490.965 744.543 492.019 C 735.745 493.073 726.927 491.856 717.777 488.693 C 708.627 485.53 699.145 480.421 672.224 448.122 C 645.303 415.824 600.943 356.335 572.825 322.411 C 544.707 288.487 532.832 280.126 520.4 275.424 C 507.967 270.722 494.979 269.677 483.035 270.795 C 471.09 271.912 460.191 275.192 450.188 280.296 C 440.186 285.401 431.08 292.331 424.308 302.322 C 417.535 312.313 413.096 325.365 411.774 340.782 C 410.452 356.199 412.249 373.982 417.566 396.019 C 422.882 418.056 431.72 444.349 446.08 477.364 C 460.441 510.378 480.324 550.116 502.543 590.457 C 524.762 630.798 549.316 671.743 575.313 709.615 C 601.309 747.487 628.748 782.285 649.877 808.503 C 671.005 834.72 685.824 852.357 701.635 870.857 C 717.447 889.357 734.252 908.721 751.606 926.236 C 768.959 943.75 786.861 959.416 800.27 970.467 C 813.68 981.518 822.596 987.955 831.024 994.949 C 839.452 1001.942 847.392 1009.493 852.6 1017.656 C 857.809 1025.819 860.287 1034.594 858.258 1042.694 C 856.229 1050.793 849.694 1058.217 843.398 1066.21 C 837.101 1074.203 831.045 1082.765 827.636 1094.165 C 824.227 1105.565 823.467 1119.803 826.451 1130.755 C 829.435 1141.708 836.165 1149.376 844.066 1155.395 C 851.968 1161.414 861.041 1165.783 872.816 1166.61 C 884.59 1167.437 899.064 1164.721 916.844 1156.439 C 934.624 1148.157 955.708 1134.309 1008.008 1100.508 C 1060.307 1066.707 1143.822 1012.953 1193.462 983.821 C 1243.102 954.689 1258.867 950.178 1272.287 948.279 C 1285.706 946.38 1296.778 947.091 1307.659 950.933 C 1318.539 954.775 1329.228 961.748 1339.219 972.735 C 1349.21 983.722 1358.503 998.723 1369.12 1021.457 C 1379.736 1044.191 1391.675 1074.658 1401.044 1100.93 C 1410.412 1127.202 1417.21 1149.279 1420.34 1167.486 C 1423.469 1185.693 1422.93 1200.029 1419.614 1218.744 C 1416.297 1237.459 1410.204 1260.553 1398.133 1283.039 C 1386.062 1305.524 1368.013 1327.401 1346.024 1345.707 C 1324.036 1364.012 1298.106 1378.746 1264.905 1387.039 C 1231.704 1395.333 1191.23 1397.185 1114.625 1397.724 C 1038.02 1398.263 925.283 1397.488 868.914 1397.101 L 812.546 1396.713" bx:d="M 807.516 1396.988 U 142.532 1399.08 U 120.056 1391.562 U 100.914 1383.077 U 80.768 1345.844 U 82.211 1330.638 U 83.489 1311.132 U 98.658 1287.023 U 119.914 1271.696 U 157.902 1265.35 U 249.977 1262.08 U 316.47 1262.645 U 355.599 1260.157 U 379.829 1256.479 U 433.25 1243.017 U 497.857 1216.859 U 524.802 1211.771 U 545.397 1213.435 U 573.21 1228.038 U 608.123 1255.613 U 631.502 1284.144 U 656.313 1305.536 U 666.822 1312.944 U 690.122 1319.437 U 717.316 1316.732 U 742.033 1295.413 U 751.131 1269.551 U 749.044 1239.239 U 710.532 1185.174 U 654.353 1133.501 U 611.948 1077.919 U 582.302 1021.227 U 560.799 963.304 U 547.764 904.547 U 541.963 851.437 U 529.568 793.657 U 503.309 739.032 U 482.688 712.107 U 444.251 674.557 U 412.132 645.974 U 340.436 597.772 U 321.832 575.994 U 291.743 523.244 U 213.658 297.106 U 211.63 253.068 U 218.514 215.201 U 242.601 161.056 U 289.799 115.005 U 335.432 100.703 U 404.656 100.46 U 488.452 117.166 U 730.779 156.47 U 757.772 174.365 U 778.145 204.074 U 790.915 250.009 U 800.431 311.429 U 798.851 360.782 U 785.685 458.215 U 770.896 484.315 U 744.563 494.29 U 718.109 490.639 U 689.663 475.312 U 556.583 296.847 U 520.956 271.766 U 481.99 268.633 U 449.291 278.471 U 421.975 299.261 U 408.656 338.417 U 414.045 391.764 U 440.557 470.641 U 500.208 589.853 U 573.87 712.688 U 656.187 817.084 U 700.642 869.993 U 751.057 928.085 U 804.763 975.081 U 831.513 994.392 U 855.331 1017.043 U 862.765 1043.37 U 843.158 1065.64 U 824.988 1091.328 U 822.706 1134.04 U 842.894 1157.044 U 870.115 1170.153 U 913.539 1162.005 U 976.793 1120.461 U 1227.336 959.199 U 1274.633 945.668 U 1307.851 947.803 U 1339.916 968.72 U 1367.797 1013.725 U 1403.614 1105.124 U 1424.008 1171.357 U 1422.391 1214.365 U 1404.11 1283.647 U 1349.965 1349.278 U 1272.177 1393.48 U 1150.757 1399.038 U 812.546 1396.713 1@758db3dd"
                    />
                </g>
        </svg>
        <button  @click="playAnimation">Play Track</button>
    </div>
</template>

<script setup lang="ts">
import { computed, ref, watch } from "vue";
import { TrackOverviewProps } from "./Types";
import { timeToSeconds } from "./TrackOverview.helper";

const props = defineProps<TrackOverviewProps>();

const isPlaying = ref(false);
const key = ref(5);

watch(() => props.activeCar, () => {
    key.value++;
    resetAnimation();
    isPlaying.value = false;
});

const playAnimation = () => {
    resetAnimation();
    isPlaying.value = !isPlaying.value;
}

const resetAnimation = () => {
    key.value++;
};

const sortedCars = computed(() => {
    const reversedCars = [...props.cars].reverse();
    const activeCarIndex = reversedCars.indexOf(props.activeCar);
    reversedCars.splice(activeCarIndex, 1);
    reversedCars.push(props.activeCar);
    return reversedCars;
})

</script>

<style scoped>
@import "../../../css/button.css";
@import "TrackOverview.css";
</style>
